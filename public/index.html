<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>ERP-IA-BOT (demo)</title>
  <style>
    body{font-family:Inter,system-ui,Segoe UI,Arial;padding:20px;max-width:800px;margin:auto}
    textarea{width:100%;height:80px}
    button{padding:8px 12px}
    pre{white-space:pre-wrap;background:#f6f6f6;padding:12px;border-radius:6px}
  </style>
</head>
<body>
  <h2>ERP-IA-BOT — Demo</h2>
  <label>Pergunta:</label>
  <textarea id="q"></textarea>
  <div style="margin:8px 0">
    <button id="send">Perguntar</button>
    <span style="margin-left:12px;color:#666">Se precisar, configure X-API-KEY no campo abaixo.</span>
  </div>

  <label>API Key (opcional):</label>
  <input id="key" style="width:100%;margin-bottom:8px" placeholder="se configured on server" />

  <h3>Resposta</h3>
  <pre id="out">—</pre>

  <script>
    document.getElementById('send').onclick = async () => {
      const q = document.getElementById('q').value.trim();
      const key = document.getElementById('key').value.trim();
      if (!q) return alert('escreve uma pergunta');

      const headers = { 'Content-Type': 'application/json' };
      if (key) headers['x-api-key'] = key;

      document.getElementById('out').textContent = 'A processar...';
      try {
        const r = await fetch('/api/query', { method: 'POST', headers, body: JSON.stringify({ question: q }) });
        const json = await r.json();
        if (!r.ok) {
          document.getElementById('out').textContent = 'Erro: ' + (json.error || JSON.stringify(json));
        } else {
          document.getElementById('out').textContent = json.answer + '\n\nFontes: ' + (json.sources || []).join(' | ');
        }
      } catch (err) {
        document.getElementById('out').textContent = 'Falha ao chamar API: ' + err;
      }
    };
  </script>
</body>
</html>